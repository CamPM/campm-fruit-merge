<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport"
      content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no" />
<title>Fruit Merge â€“ Mobile Safe</title>

<script src="https://cdn.jsdelivr.net/npm/matter-js@0.19.0/build/matter.min.js"></script>

<style>
/* â”€â”€â”€â”€â”€â”€â”€â”€â”€ GLOBAL SAFETY (iOS FIXES) â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
html, body, canvas {
    margin: 0;
    padding: 0;
    overflow: hidden;
    touch-action: none;
    user-select: none;
    -webkit-user-select: none;
    -webkit-touch-callout: none;
    background: #E6E6FA;
    font-family: system-ui, sans-serif;
}

/* â”€â”€â”€â”€â”€â”€â”€â”€â”€ UI â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
.btn {
    position: absolute;
    z-index: 10;
    padding: 8px 10px;
    border-radius: 8px;
    border: 2px solid #333;
    background: #2ecc71;
    color: #fff;
    font-weight: bold;
}

#shopBtn { right: 10px; bottom: 10px; }
#helpBtn { right: 80px; bottom: 10px; }
.pwr { left: 10px; bottom: 10px; background:#e67e22; }
#p2 { left: 55px; background:#9b59b6; }
#p3 { left: 100px; background:#f1c40f; }

/* â”€â”€â”€â”€â”€â”€â”€â”€â”€ MODALS â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
.modal {
    display:none;
    position:fixed;
    inset:20px;
    background:#fff;
    z-index:50;
    border-radius:16px;
    padding:12px;
    overflow:auto;
}

.grid {
    display:grid;
    grid-template-columns:repeat(auto-fill,minmax(70px,1fr));
    gap:8px;
}

.card {
    border:2px solid #ccc;
    border-radius:10px;
    padding:6px;
    text-align:center;
    font-size:12px;
}

.card.active {
    border-color:#2ecc71;
    background:#f0fff4;
}

#gameOver {
    display:none;
    position:fixed;
    inset:0;
    background:rgba(0,0,0,.85);
    color:white;
    z-index:100;
    text-align:center;
    padding-top:40vh;
}
</style>
</head>

<body>

<button id="helpBtn" class="btn" onclick="openModal('help')">?</button>
<button id="shopBtn" class="btn" onclick="openModal('shop')">SHOP</button>

<button class="btn pwr" onclick="prepPower('bomb')">ðŸ’£</button>
<button class="btn pwr" id="p2" onclick="prepPower('wipe')">ðŸ§¹</button>
<button class="btn pwr" id="p3" onclick="prepPower('evo')">âœ¨</button>

<div id="help" class="modal">
<h3>How To Play</h3>
<p>Drop items. Merge identical tiers. Donâ€™t let items stay above the red line.</p>
<button onclick="closeModal('help')">START</button>
</div>

<div id="shop" class="modal">
<h3>Shop</h3>
<p>Wallet: <b id="walletUI">0</b></p>
<h4>Skins</h4><div id="skins" class="grid"></div>
<h4>Themes</h4><div id="themes" class="grid"></div>
<button onclick="closeModal('shop')">CLOSE</button>
</div>

<div id="gameOver">
<h1>GAME OVER</h1>
<p>Score: <span id="finalScore">0</span></p>
<button onclick="restart()">RETRY</button>
</div>

<script>
/* â”€â”€â”€â”€â”€â”€â”€â”€â”€ CONTENT â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
const SKINS = {
Fruit:["ðŸ’","ðŸ“","ðŸ‡","ðŸŠ","ðŸŽ","ðŸ","ðŸ‘","ðŸ","ðŸˆ","ðŸ‰","ðŸ¥¥","ðŸŽƒ"],
Animals:["ðŸ­","ðŸ°","ðŸ¦Š","ðŸ»","ðŸ¼","ðŸ¦","ðŸ¯","ðŸ·","ðŸ¸","ðŸ™","ðŸ³","ðŸ¦„"],
Retro:["â–²","â– ","â¬¢","â—†","â˜…","âœš","âœ–","â¬¤","â¬Ÿ","â–¼","â¬“","âŒ¬"],
Space:["â˜„ï¸","ðŸ›°ï¸","ðŸª","ðŸŒ™","â˜€ï¸","ðŸ”­","ðŸš€","ðŸ‘½","ðŸ›¸","ðŸŒŒ","ðŸŒ ","ðŸ‘¨â€ðŸš€"],
Desserts:["ðŸª","ðŸ©","ðŸ§","ðŸ¦","ðŸ°","ðŸ¥§","ðŸ«","ðŸ¬","ðŸ­","ðŸ®","ðŸ¯","ðŸŽ‚"],
Cars:["ðŸŽï¸","ðŸš—","ðŸš•","ðŸš™","ðŸšŒ","ðŸš","ðŸš›","ðŸšœ","ðŸš“","ðŸš‘","ðŸš’","ðŸš€"],
Plants:["ðŸŒ¿","ðŸŒµ","ðŸª´","ðŸŒ²","ðŸŒ³","ðŸŒ´","ðŸŽ‹","ðŸŒ¿","ðŸ€","ðŸ„","ðŸŒ»","ðŸŒ¹"]
};

const THEMES = {
Lilac:"#E6E6FA", Sunset:"#ff7675", Forest:"#55efc4", Midnight:"#2d3436",
Gold:"#fdcb6e", Slate:"#718093", Ocean:"#0984e3", Cherry:"#d63031",
Mint:"#00b894", Grape:"#6c5ce7", Pumpkin:"#e67e22", Coffee:"#634832",
Rose:"#fd79a8", Sky:"#81ecec", Grass:"#26de81", Charcoal:"#2f3640"
};

const SIZES=[18,24,30,38,46,55,65,76,88,101,115,130];

/* â”€â”€â”€â”€â”€â”€â”€â”€â”€ STATE â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
let state={
score:0, high:0, pts:0,
skin:"Fruit", theme:"Lilac",
owned:["Fruit","Lilac"],
over:false
};

/* â”€â”€â”€â”€â”€â”€â”€â”€â”€ MATTER SETUP â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
const {Engine,Render,Runner,Bodies,Composite,Events,Vector} = Matter;
let engine=Engine.create();
let render=Render.create({
element:document.body,
engine,
options:{
width:window.innerWidth,
height:window.innerHeight,
wireframes:false,
background:"transparent"
}
});

function buildWalls(){
Composite.clear(engine.world,false);
const w=render.options.width;
const h=render.options.height;
Composite.add(engine.world,[
Bodies.rectangle(w/2,h-40,w,20,{isStatic:true}),
Bodies.rectangle(-10,h/2,20,h,{isStatic:true}),
Bodies.rectangle(w+10,h/2,20,h,{isStatic:true})
]);
}

buildWalls();
Render.run(render);
Runner.run(Runner.create(),engine);

/* â”€â”€â”€â”€â”€â”€â”€â”€â”€ GAME LOGIC â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
let current=0,next=Math.floor(Math.random()*4),canDrop=true,activePower=null;

Events.on(render,"afterRender",()=>{
const ctx=render.context;
const w=render.options.width;
const h=render.options.height;

document.body.style.background=THEMES[state.theme];

ctx.fillStyle="white";
ctx.fillRect(0,0,w,110);
ctx.fillRect(0,h-60,w,60);

ctx.strokeStyle="red";
ctx.setLineDash([6,6]);
ctx.beginPath();
ctx.moveTo(0,110);ctx.lineTo(w,110);ctx.stroke();
ctx.setLineDash([]);

ctx.fillStyle="#333";
ctx.font="bold 14px sans-serif";
ctx.fillText("Score "+state.score,10,30);
ctx.fillText("Best "+state.high,w-100,30);

ctx.font="32px serif";
ctx.fillText(SKINS[state.skin][next],w/2-16,60);

Composite.allBodies(engine.world).forEach(b=>{
if(b.plugin?.t!=null){
ctx.save();
ctx.translate(b.position.x,b.position.y);
ctx.rotate(b.angle);
ctx.font=`${SIZES[b.plugin.t]*1.4}px serif`;
ctx.textAlign="center";
ctx.textBaseline="middle";
ctx.fillText(SKINS[state.skin][b.plugin.t],0,0);
ctx.restore();
}
});
});

/* â”€â”€â”€â”€â”€â”€â”€â”€â”€ COLLISIONS â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
Events.on(engine,"collisionStart",e=>{
e.pairs.forEach(p=>{
const a=p.bodyA,b=p.bodyB;
if(a.plugin?.t===b.plugin?.t && a.plugin.t<11){
const t=a.plugin.t;
Composite.remove(engine.world,[a,b]);
Composite.add(engine.world,
Bodies.circle(
(a.position.x+b.position.x)/2,
(a.position.y+b.position.y)/2,
SIZES[t+1],
{restitution:.3,plugin:{t:t+1,s:Date.now()}}
));
state.score+=(t+1)*10;
state.pts+=(t+1);
state.high=Math.max(state.high,state.score);
}
});
});

/* â”€â”€â”€â”€â”€â”€â”€â”€â”€ GAME OVER CHECK â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
Events.on(engine,"afterUpdate",()=>{
if(state.over)return;
Composite.allBodies(engine.world).forEach(b=>{
if(!b.isStatic && b.position.y<110 &&
Date.now()-(b.plugin?.s||0)>3000){
state.over=true;
document.getElementById("finalScore").textContent=state.score;
document.getElementById("gameOver").style.display="block";
}
});
});

/* â”€â”€â”€â”€â”€â”€â”€â”€â”€ INPUT â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
const canvas=render.canvas;
canvas.addEventListener("pointerup",e=>{
if(state.over||!canDrop)return;
const rect=canvas.getBoundingClientRect();
const x=e.clientX-rect.left;
const y=e.clientY-rect.top;
if(y<110||y>render.options.height-60)return;

Composite.add(engine.world,
Bodies.circle(x,110,SIZES[current],
{restitution:.3,plugin:{t:current,s:Date.now()}})
);
current=next;
next=Math.floor(Math.random()*4);
canDrop=false;
setTimeout(()=>canDrop=true,400);
});

/* â”€â”€â”€â”€â”€â”€â”€â”€â”€ UI â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
function openModal(id){document.getElementById(id).style.display="block";renderShop();}
function closeModal(id){document.getElementById(id).style.display="none";}
function prepPower(p){activePower=p;}
function restart(){location.reload();}

function renderShop(){
document.getElementById("walletUI").textContent=state.pts;
document.getElementById("skins").innerHTML=
Object.keys(SKINS).map(k=>`
<div class="card ${state.skin===k?"active":""}"
onclick="state.skin='${k}'">${SKINS[k][0]}<br>${k}</div>`).join("");
document.getElementById("themes").innerHTML=
Object.keys(THEMES).map(k=>`
<div class="card ${state.theme===k?"active":""}"
style="background:${THEMES[k]}"
onclick="state.theme='${k}'">${k}</div>`).join("");
}

/* â”€â”€â”€â”€â”€â”€â”€â”€â”€ HARD iOS SAFETY â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
document.addEventListener("touchstart",e=>e.preventDefault(),{passive:false});
document.addEventListener("contextmenu",e=>e.preventDefault());
</script>

</body>
</html>
